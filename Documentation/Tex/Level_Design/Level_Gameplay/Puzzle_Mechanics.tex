\subsubsection{Puzzle Mechanics}

There are various mechanics involved in the second part of the level.

\textbf{Minerva and Delphini} Minerva will have to take advantage of her cat form in order to move through some hidden passages. Moving through these is a requirement to reach the end of the level (Gryffindor's Dormitory), but isn't strictly necessary for the parallel corridoirs on the right side. There, with good timing, the player can take advantage of the top-side opening to loop around the prefect in the top corridoir. However this is more of a challenge for players who like to challenge themselves; using the secret passage is the easiest and intended solution.

Minerva can tell Delphini to follow her or stop in a place at any time and in any form. The player has to control Delphini this way. 


\textbf{Prefects}
In Cat form the player can willingly enter a Prefect's FOV to distract him. Combined with the previous mechanic, the player can make Delphini start moving through a dangerous area, then immediately distract the Prefect so that Delphini can reach her destination safely.

Being seen by a Prefect in human form is more of a nuisance. Minerva will be separated from Delphini as they will be directed to the respective Dormitories. In this case the player with Minerva has to first find Delphini (who will be in the closest of the predefined Hiding Spots), and then proceed through the level.

\textbf{Caretaker(s)}
The real enemy here is the Caretaker. There are multiple instances of him across the map, but the player should have the feeling that it's always the same NPC who is unexplicably doing an excellent job as checking the whole castle at any time (some aesthetic-only doors in the environment around his patrol zones should give the idea that he too is using some secret passages to reach different places that quickly)

Being caught by the Caretaker in human form is an instant game over, sending the player to the end of the level but with his missions failed. However being caught while in human form gives the player one more chance, since the first time he's caught Minerva will be thrown out of the castle, and will have to restart from the beginning. If this happens before Delphini reaches her Dormitory, she will again hide in the closest Hiding Spot, and the player will have to first find her.

When the Caretaker spots Minerva in her Cat-Form, he will try to catch her, following her steps. During that phase all other "Caretaker" instances will be temporarily disabled, until the Caretaker following the player renounces and goes out of sight. Other Caretakers will respawn except for the ones which spawn is inside the player's view; those will only respawn when the player loses sight over their spawn position. The Caretaker following the player will gradually increase his walking speed. In order to make him renounce, the player has to go in a Cat-Form only passage, or turn multiple corners before he gets too close. This can be exploited by the user as a dangerous way to distract the Caretaker and get him off of otherwhise more strictly guarded areas.

The Caretaker cannot be distinguished from Prefects until Minerva is 4 or less tiles away from him.

\textbf{Puzzle-specific UI and navigation}
There will be two arrows on the top and right borders of the screen, pointing respectively to Gryffindor's and Slytherin's dormitories; each will be identified by that House's blazon, and they will move along the dedicated border.

For example, Gryffindor's arrow will stay on the very left of the top border as long as that dormitory's entrance's X coordinate is outside of the very left of the player view. Same for the right. When the entrance's X coordinate is within the player view's width (regardless of if it's vertically inside the player's view) it will move to point at the exact position of the dormitory entrance. The idea is to give the player an overall idea of the dormitories exact position despite not having either of them on screen. Since they are both on the extreme borders of the map there's no concern that the player might go up over Gryffindor's dormitory entrance or right over Slytherin's.

\textbf{Rewards/Results}

Part 1 (with Delphini):

\begin{itemize}
    \item Accept to help Delphini:
	\begin{itemize}
		\item Reach Delphini's Dormitory successfully: +10 Friendship.
		\item Delphini Caught: -10 Points to Slytherin, -10 Friendship.
		\item Minerva Caught: -10 Points to both Slytherin and Gryffindor, -4 Friendship
	\end{itemize}
	\item Refuse to help Delphini: -10 Points to Slytherin, -8 Friendship.
\end{itemize}

Part 2 (Alone), carries rewards from part 1:

\begin{itemize}
	\item Reach Minerva's Dormitory successfully: nothing, have rewards from part 1 already.
	\item Minerva Caught: -10 Points to Gryffindor.
\end{itemize}
